#!/bin/bash
#set -x
#trap read debug
# ubuntu.com/security/CVE-2020-15702
# accessed 2020-12-17
ubuntuVersions=(14.04 16.04 18.04 20.04 20.10)
localVersion=`egrep 'VERSION_ID=' /etc/os-release | sed -r 's/.*=//g' | tr -d '"'` 

# updated apport ubuntu versions
apportUbuntu1604="2.20.1-0ubuntu.2.24"
apportUbuntu2004="2.20.11-0ubuntu27.6"

echo [+] Ubuntu check for CVE-2020-15702

for i in "${ubuntuVersions[@]}"
do
    if [ "$i" == "$localVersion" ] ; then
        echo [+] Host: $HOSTNAME is version "$i"
    fi
done

if [[ "$localVersion" == "14.04" ]] ; then
    echo "Still to be done"
elif [[ "$localVersion" == "16.04" ]] ; then
    apportVersion=`dpkg-query -W apport | cut -f2`
    echo [+] Apport version: "$apportVersion"
    if [[ "$apportVersion" != "$apportUbuntu1604" ]] ; then
    echo [+] Patched version is: $apportUbuntu1604
    echo [+] The local apport version might be vulnerable!
    fi
elif [[ "$localVersion" == "20.04" ]] ; then
    apportVersion=`dpkg-query -W apport | cut -f2`
    echo [+] Apport version: "$apportVersion"
    if [[ "$apportVersion" != "$apportUbuntu2004" ]] ; then
    echo [+] Patched version is: $apportUbuntu2004
    echo [+] The local apport version might be vulnerable!
    fi
fi
